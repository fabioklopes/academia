{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="mb-0">Editar Aluno</h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" action="{% url 'edit_student' user_id=student.id %}">
                        {% csrf_token %}
                        <!-- ... (campos anteriores do formulário) ... -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="first_name" name="first_name" placeholder="Primeiro Nome" value="{{ student.first_name }}" required>
                                    <label for="first_name">Primeiro Nome</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Último Nome" value="{{ student.last_name }}" required>
                                    <label for="last_name">Último Nome</label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="identification" name="identification" placeholder="Documento (CPF)" pattern="\d{11}" title="Digite um CPF válido com 11 dígitos" value="{{ student.identification }}" required>
                                    <label for="identification">Documento (CPF)</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="date" class="form-control" id="birthday" name="birthday" value="{{ student.birthday|date:'Y-m-d' }}" required>
                                    <label for="birthday">Data de Nascimento</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-floating">
                                <input type="email" class="form-control" id="email" name="email" placeholder="E-mail" value="{{ student.email }}" required>
                                <label for="email">E-mail</label>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="WhatsApp" pattern="[0-9]{11}" title="Digite um número de WhatsApp válido com DDD (ex: 11987654321)" value="{{ student.phone }}">
                                    <label for="phone">WhatsApp</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select class="form-select" id="current_belt" name="current_belt" aria-label="Faixa Atual">
                                        {% for belt_key, belt_value in belts %}
                                            <option value="{{ belt_key }}" {% if student.current_belt == belt_key %}selected{% endif %}>{{ belt_value }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="current_belt">Faixa Atual</label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select class="form-select" id="current_degree" name="current_degree" aria-label="Graus na Faixa">
                                        {% for degree_key, degree_value in degrees %}
                                            <option value="{{ degree_key }}" {% if student.current_degree == degree_key %}selected{% endif %}>{{ degree_value }}</option>
                                        {% endfor %}
                                    </select>
                                    <label for="current_degree">Graus na Faixa</label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input type="date" class="form-control" id="start_date" name="start_date" value="{{ student.start_date|date:'Y-m-d' }}">
                                    <label for="start_date">Data de Início dos Treinos</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Upload de Foto de Perfil</label>
                            {% if student.image_profile %}
                                <p>Atual: <a href="{{ student.image_profile.url }}">{{ student.image_profile.name }}</a></p>
                            {% endif %}
                            <div>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="upload-btn">Selecionar do dispositivo</button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="camera-btn">Usar Câmera</button>
                            </div>
                            <input class="form-control" type="file" id="image_profile" name="image_profile" accept="image/*" style="display: none;">
                            <div id="file-name-display" class="mt-2 text-muted"></div>
                        </div>

                        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    const uploadBtn = document.getElementById('upload-btn');
    const cameraBtn = document.getElementById('camera-btn');
    const fileInput = document.getElementById('image_profile');
    const fileNameDisplay = document.getElementById('file-name-display');

    uploadBtn.addEventListener('click', () => {
        fileInput.removeAttribute('capture');
        fileInput.click();
    });

    cameraBtn.addEventListener('click', () => {
        fileInput.setAttribute('capture', 'user');
        fileInput.click();
    });

    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = `Arquivo selecionado: ${fileInput.files[0].name}`;
        } else {
            fileNameDisplay.textContent = '';
        }
    });
</script>
{% endblock %}
{% endblock %}
